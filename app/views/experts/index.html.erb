<div class="container">
  <% if flash[:notice] %>
    <div class="notice alert alert-success"><%= flash[:notice] %></div>
  <% end %>

  <div class="row border expert-filter shadow p-3 mb-5 bg-body rounded">
    <div class="row col-12 col-sm-12 col-md-12 col-lg-12">
    <%= form_tag(search_experts_path, :method => "get") do %>
     <div class="input-group ">
      <%= search_field_tag :query, params[:query], placeholder: "Введите фамилию врача или категорию...", class: "form-control input-lg", id: "tag" %>
      <div class="input-group-btn">
        <%= button_tag "Search", :class => 'btn btn-outline-success',:name => nil%>
      </div>
    </div>
   <% end %>
   </div>

     <div class="row col-12 col-sm-5 col-md-7 col-lg-7 filter">
       <div class = "col-sm-6">

        <%= form_tag(search_experts_path, method: :get) do |form| %>
         <%= select_tag :filter, options_for_select(["Сортировать по",["От высшей категории к низшей", "downcategory"], ["От низшей категории к высшей","upcategory"],["От большого стажа к небольшому", "downexperience"], ["От небольшого стажа к большому","upexperience"]]), class: 'form-control selector'%>
        <% end %>
      </div>
      <div class="col-sm-6">
        <!-- <span>Paccписание на </span>
       <input id="mydate" type="date"  > -->
     </div>


   </div>
  </div>

  <% @experts.each do |expert| %>
    <div class="row border expert-cart shadow p-3 mb-5 bg-body rounded">
      <div class="row col-12 col-sm-8 col-md-8 col-lg-8">
        <div class="col-3 col-sm-12 col-md-3 col-lg-3">
          <%= image_tag(expert.image.url || current_user.image, size: "150x150", class: "img-fluid") %>
          <small><i class='fas fa-star gold-star'></i><%= expert.rating %></small>
          <small>Отзывов: <%= expert.comments.count %></small>
        </div>
        <div class="col-12 col-sm-9 border-right">
          <h4><%= link_to expert.full_name, expert_path(expert) %></h4>
          <div class="col-12 col-sm-6  col-md-6 col-ld-6">
           <h6 class="text-secondary"><%= expert.category.name %></h6>
          </div>
          <div class="col-12 col-sm-6 col-md-6 col-ld-6">
           <strong><%= expert.level&.name %></strong>
          </div>

          <div class="col-12 col-sm-6 col-md-6 col-ld-6">
           <span class="badge rounded-pill bg-success"><%= expert.experience%></span><span> лет опыта</span>
          </div>
          <div class="col-12 col-sm-12 col-md-12 col-lg-12">
           <%= truncate(expert.description, length: 140, separator: '...') %>
          </div>
       </div>
      </div>
      <div class="row col-sm-4">
            <%= render 'experts/time_slots', expert: expert %>
      </div>
      <div class="row col-8 col-sm-12 col-md-8 col-lg-8">
        <div class="row">
          <div class="btn-group " role="group" aria-label="Basic example">
            <div class="col-sm-6">
              <%= link_to(new_expert_event_path(expert), method: :get, class: "btn btn-primary button-contact") do %>
                <i class="fa fa-calendar"></i><span> Записаться</span>
              <% end %>
            </div>
            <div class="col-sm-6">
            <!-- <button href="/events/new" controller="events "action="new" class="btn btn-primary"><i class="fa fa-calendar"></i> Записаться</button> -->
              <button href="#" class="btn btn-info text-white button-contact" data-toggle="modal" data-target=".bd-example-modal-lg-<%=expert.id%>"><i class="fas fa-phone-alt"></i> Контакты</button>
              <div class="modal fade bd-example-modal-lg-<%=expert.id%>" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title">Контакты</h5>
                    </div>
                    <div class="modal-body">
                      <div class="row">
                      <div class="col-sm-7">
                      <%if expert.address.present? %>
                      <iframe
                        width="460"
                        height="470"
                        style="border:0"
                        loading="lazy"
                        allowfullscreen
                        src="https://www.google.com/maps/embed/v1/place?key=<%= ENV.fetch("API_KEY") %>
                          &q=Черкассы+<%= set_address(expert.address) %>">
                      </iframe>
                      <% else %>
                      <iframe
                        width="460"
                        height="470"
                        style="border:0"
                        loading="lazy"
                        allowfullscreen
                        src="https://www.google.com/maps/embed/v1/place?key=<%= ENV.fetch("API_KEY") %>
                          &q=Черкассы">
                      </iframe>
                      <% end %>
                      </div>
                      <div class="col-sm-5">
                        <h5 class="text-center text-primary">Адрес</h5>
                        <p class="text-center text-secondary"><%= expert.address %></p>
                        <hr>
                        <h5 class="text-center text-primary">Телефон</h5>
                        <p class="text-center text-secondary"><%= expert.phone %></p>
                        <hr>
                        <h5 class="text-center text-primary">Время работы</h5>
                        <p class="text-center text-secondary">Пн: <%= expert.hw_start_monday %>-<%= expert.hw_end_monday %></p>
                        <p class="text-center text-secondary">Вт: <%= expert.hw_start_thursday %>-<%= expert.hw_end_thursday  %></p>
                        <p class="text-center text-secondary">Ср: <%= expert.hw_start_wednesday %>-<%= expert.hw_end_wednesday %></p>
                        <p class="text-center text-secondary">Чт: <%= expert.hw_start_tuesday %>-<%= expert.hw_end_tuesday %></p>
                        <p class="text-center text-secondary">Пт: <%= expert.hw_start_friday %>-<%= expert.hw_end_friday %></p>
                        <p class="text-center text-secondary">Сб: <%= expert.hw_start_saturday %>-<%= expert.hw_end_saturday %></p>
                        <p class="text-center text-secondary">Вс: <%= expert.hw_start_sunday %>-<%= expert.hw_end_sunday %></p>
                        <hr>
                      </div>
                      </div>


                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>

        <div>
      </div>
    </div>
  <% end %>

</div>

<%= will_paginate @experts, class: "pagination" %>

<script>
$(document).ready(function(){
$( function() {
  var availableTags = [
    "Гастроэнтеролог",
    "Невролог",
    "Офтальмолог",
    "Стоматолог",
    "Терапевт",
    "Ортопед"
  ];
  $( "#tag" ).autocomplete({
    source: availableTags
  });
  });
 });

 $(document).ready(function(){
 $('.selector').change(function(){
   this.form.submit()
 });
});
// $(document).ready(function(){
//   $("#mydate").("setDate", new Date())
// });
</script>
